(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{157:function(e,t,i){"use strict";i.d(t,"a",function(){return m});var a=i(0),s=i(8),o=i(2),n=i(7),l=i(141),r=i(330),d=i(144),c=i(148),h=i(170),p=i(1);let m=class extends p.Component{constructor(){super(...arguments),this.valueToAdd="",this.expandIndex=-1}addItem(){this.valueToAdd.replace(/\W/,"").length&&(this.props.value.push(this.valueToAdd),this.valueToAdd="",(this.props.onChange||(()=>{}))(this.props.value))}render(){return p.createElement("div",{className:"elc-c",style:this.props.style},p.createElement("div",{className:"editable-list"},p.createElement("div",{className:"input",style:this.props.value.length?{}:{borderBottom:"none"}},p.createElement(s.k,null,p.createElement(s.c,{xs:this.props.disabled?24:20,sm:this.props.disabled?24:21},p.createElement("input",{className:"new-item-input",style:this.props.value.length>0?void 0:{borderBottom:"none"},placeholder:this.props.label||void 0,onKeyDown:e=>{13===e.keyCode&&(this.addItem(),e.preventDefault())},onKeyUp:e=>{13===e.keyCode&&(this.addItem(),e.preventDefault())},value:this.valueToAdd,onChange:e=>this.valueToAdd=e.target.value,disabled:this.props.disabled})),p.createElement(s.c,{xs:4,sm:3,style:{textAlign:"right"}},this.props.disabled?"":p.createElement(l.a,{className:"input-icon",iconName:"Add",onClick:()=>{this.addItem()}})))),this.props.value.length?p.createElement("div",{className:"items"},p.createElement(r.a,{compact:!0,items:[...this.props.value.map((e,t)=>[p.createElement("div",{id:t.toString()},this.expandIndex===t?p.createElement("div",{className:"list-item"},p.createElement(d.a,{multiline:!0,value:e,onBlur:()=>this.expandIndex=-1,disabled:this.props.disabled,autoFocus:!0,onChange:(e,i)=>{this.props.value[t]=i,(this.props.onChange||(()=>{}))(this.props.value)}})):p.createElement("div",{className:"el-expander",onClick:()=>{this.expandIndex=t}},e.length>30?e.substr(0,25)+"...":e),p.createElement(c.a,{className:"delete",iconProps:{iconName:"trash"},onClick:e=>{this.expandIndex=-1,this.props.value.splice(t,1),(this.props.onChange||(()=>{}))(this.props.value)},disabled:this.props.disabled}))])],isHeaderVisible:!1,selectionMode:h.b.none})):""))}};a.c([o.k],m.prototype,"valueToAdd",void 0),a.c([o.k],m.prototype,"expandIndex",void 0),m=a.c([n.a],m)},296:function(e,t,i){"use strict";i.r(t),i.d(t,"OrthoRecordsPanel",function(){return k});var a=i(0),s=i(8),o=i(3),n=i(13),l=i(4),r=i(157),d=i(38),c=i(2),h=i(7),p=i(146),m=i(10),b=i(330),u=i(170),v=i(161),g=i(333),E=i(138),C=i(148),y=i(301),O=i(144),j=i(141),A=i(137),N=i(81),x=i(1);const f=["Frontal","Right Buccal","Left Buccal","Palatal","Lingual"];let k=class extends x.Component{constructor(){super(...arguments),this.selectedPhotoId="",this.zoomedColumn=-1,this.expandedField="",this.uploadingPhotoID="",this.imagesTable={},this.showGrid=!1,this.overlayWithPrev=!1,this.overlayWithNext=!1,this.openCallouts=[],this.stopObservation=function(){}}get canEdit(){return o.B.currentUser.canEditOrtho}get dates(){return this.props.orthoCase.patient?this.props.orthoCase.patient.appointments.map(e=>({date:e.date,treatmentType:(e.treatment||{type:""}).type})).sort((e,t)=>t.date-e.date):[]}get allImages(){return this.props.orthoCase.visits.reduce((e,t)=>(t.photos.map(e=>e.photoID).forEach(t=>{t&&e.push(t)}),e),[])}componentDidMount(){this.allImages.forEach(e=>a.b(this,void 0,void 0,function*(){yield this.addImage(e)})),this.stopObservation=this.observe()}componentWillUnmount(){this.stopObservation()}addImage(e){return a.b(this,void 0,void 0,function*(){this.imagesTable[e]="";const t=yield o.n.get(e);this.imagesTable[e]=t})}removeImage(e){return a.b(this,void 0,void 0,function*(){yield o.n.remove(e),delete this.imagesTable[e]})}observe(){return Object(c.l)(this.props.orthoCase,e=>{if("visits"===e.name){const e=Object(d.diff)(Object.keys(this.imagesTable).sort(),this.allImages.sort());e.added.forEach(e=>{this.addImage(e)}),e.removed.forEach(e=>{this.removeImage(e)})}})}render(){return x.createElement("div",{className:"ortho-records"},x.createElement(s.l,{title:Object(o.A)("Problems")},0===this.props.orthoCase.computedProblems.length&&0===this.props.orthoCase.problemsList.length?x.createElement(p.a,{messageBarType:m.a.warning},Object(o.A)("This patient does not seem to have any problems or concerns, have you filled the case sheet?")):x.createElement(b.a,{compact:!0,items:[...[...this.props.orthoCase.computedProblems,...this.props.orthoCase.problemsList.map(e=>Object(o.A)("Patient concern")+": "+e)].map((e,t)=>[`${t+1}. ${e}`])],isHeaderVisible:!1,selectionMode:u.b.none})),x.createElement(s.l,{title:Object(o.A)("Treatment Plan")},this.props.orthoCase.treatmentPlan_appliance.length?"":x.createElement(p.a,{messageBarType:m.a.warning},Object(o.A)("A treatment plan must be before starting the treatment")),x.createElement(r.a,{label:Object(o.A)("Add Plan"),value:this.props.orthoCase.treatmentPlan_appliance,onChange:e=>{this.props.orthoCase.treatmentPlan_appliance=e,this.tu()},disabled:!this.canEdit})),x.createElement(s.l,{title:Object(o.A)("Started/Finished")},x.createElement(s.k,{gutter:12},x.createElement(s.c,{span:12},x.createElement(v.a,{onText:Object(o.A)("Started"),offText:Object(o.A)("Not started yet"),checked:this.props.orthoCase.isStarted,onChange:(e,t)=>this.props.orthoCase.isStarted=t,disabled:!this.canEdit}),this.props.orthoCase.isStarted?x.createElement(g.a,{selectedKey:this.props.orthoCase.startedDate.toString(),options:this.dates.map(e=>({key:e.date.toString(),text:`${Object(l.j)(e.date,n.bb.getSetting("date_format"))} ${e.treatmentType?`, ${e.treatmentType}`:""}`})),disabled:!this.canEdit,onChange:(e,t)=>{this.props.orthoCase.startedDate=Object(l.r)(t.key)}}):"")," ",x.createElement(s.c,{span:12},x.createElement(v.a,{onText:Object(o.A)("Finished"),offText:Object(o.A)("Not finished yet"),checked:this.props.orthoCase.isFinished,onChange:(e,t)=>this.props.orthoCase.isFinished=t,disabled:!this.canEdit}),this.props.orthoCase.isFinished?x.createElement(g.a,{selectedKey:this.props.orthoCase.finishedDate.toString(),options:this.dates.map(e=>({key:e.date.toString(),text:`${Object(l.j)(e.date,n.bb.getSetting("date_format"))} ${e.treatmentType?`, ${e.treatmentType}`:""}`})),disabled:!this.canEdit,onChange:(e,t)=>{this.props.orthoCase.finishedDate=Object(l.r)(t.key)}}):""))),x.createElement(s.l,{title:Object(o.A)("Records")},o.z.online?o.z.dropboxActive?x.createElement("div",{className:"album"},this.props.orthoCase.visits.length?x.createElement("table",null,x.createElement("tbody",null,x.createElement("tr",null,x.createElement("td",null),f.map((e,t)=>-1!==this.zoomedColumn&&this.zoomedColumn!==t?void 0:x.createElement("td",{key:e},this.zoomedColumn===t?x.createElement("p",{className:"column-header"},f[t]):x.createElement("p",{className:"term-initials"},f[t].split(" ").map(e=>e.charAt(0)).join("")),x.createElement("br",null),x.createElement(E.a,{content:Object(o.A)("Zoom")},x.createElement(C.a,{iconProps:{iconName:this.zoomedColumn===t?"ZoomOut":"ZoomIn"},className:"clickable-icon",onClick:()=>{this.zoomedColumn!==t?this.zoomedColumn=t:this.zoomedColumn=-1}})),this.zoomedColumn===t?x.createElement(E.a,{content:Object(o.A)("View grid")},x.createElement(C.a,{iconProps:{iconName:"gridViewSmall"},className:"clickable-icon",onClick:()=>{this.showGrid=!this.showGrid}})):"")),x.createElement("td",null)),this.props.orthoCase.visits.slice().sort((e,t)=>e.visitNumber-t.visitNumber).map((e,t,i)=>{const a=i[t-1]||new n.x,r=i[t+1]||new n.x;return[x.createElement("tr",{key:e.id},x.createElement("td",null,x.createElement(E.a,{content:`#${e.visitNumber}, ${Object(l.j)(e.date,n.bb.getSetting("date_format"))}`},x.createElement(C.a,{id:e.id.replace(/[0-9]/g,""),iconProps:{iconName:"info"},onClick:()=>{this.openCallouts.push(e.id)}})),x.createElement(y.a,{onDismiss:()=>{this.openCallouts=this.openCallouts.filter(t=>t!==e.id)},hidden:-1===this.openCallouts.indexOf(e.id),className:"visit-dialog"},x.createElement(b.a,{compact:!0,items:[[x.createElement("div",{id:"gf-visit"},"gf-visit"===this.expandedField?x.createElement(O.a,{autoFocus:!0,type:"number",label:Object(o.A)("Visit number"),value:e.visitNumber.toString(),onBlur:()=>{this.expandedField=""},disabled:!this.canEdit,onChange:(e,i)=>{this.props.orthoCase.visits[t].visitNumber=Object(l.r)(i),this.tu()}}):`${Object(o.A)("Visit")} #${e.visitNumber}`)],[x.createElement("div",{id:"gf-date"},"gf-date"===this.expandedField?x.createElement(g.a,{label:Object(o.A)("Visit date"),selectedKey:e.date.toString(),disabled:!this.canEdit,options:this.dates.map(e=>({key:e.date.toString(),text:`${Object(l.j)(e.date,n.bb.getSetting("date_format"))} ${e.treatmentType?`, ${e.treatmentType}`:""}`})),onChange:(e,i)=>{this.props.orthoCase.visits[t].date=Object(l.r)(i.key),this.tu()}}):`${Object(o.A)("Date")}: ${Object(l.j)(e.date,n.bb.getSetting("date_format"))}`)],[x.createElement("div",{id:"gf-appliance"},"gf-appliance"===this.expandedField?x.createElement(O.a,{autoFocus:!0,label:Object(o.A)("Appliance"),disabled:!this.canEdit,value:e.appliance,onBlur:()=>{this.expandedField=""},multiline:!0,onChange:(e,i)=>{this.props.orthoCase.visits[t].appliance=i,this.tu()}}):`${Object(o.A)("Appliance")}: ${e.appliance?e.appliance:Object(o.A)("No appliance info")}`)]],isHeaderVisible:!1,selectionMode:u.b.none,onActiveItemChanged:e=>{this.expandedField=e[0].props.id}}))),f.map((i,d)=>{const c=e.photos[d];if(-1===this.zoomedColumn||this.zoomedColumn===d)return x.createElement("td",{key:i},this.showGrid&&this.zoomedColumn===d&&this.imagesTable[c.photoID]?x.createElement(s.e,null):"",c.photoID?this.imagesTable[c.photoID]?x.createElement("div",{key:e.id,className:"photo",onClick:()=>{this.selectedPhotoId=c.id}},x.createElement(j.a,{iconName:"MiniExpandMirrored",className:"hover-effect"}),x.createElement("img",{style:{width:"100%"},src:this.imagesTable[c.photoID],className:"ortho-img-el"}),this.selectedPhotoId===c.id?x.createElement(y.a,{modalProps:{className:"photo-dialog"},hidden:!1,onDismiss:()=>this.selectedPhotoId=""},x.createElement("div",{style:{position:"relative"}},x.createElement("img",{style:{width:"100%"},src:this.imagesTable[c.photoID]}),this.overlayWithNext?x.createElement("img",{className:"overlay-img",src:this.imagesTable[r.photos[d].photoID]}):"",this.overlayWithPrev?x.createElement("img",{className:"overlay-img",src:this.imagesTable[a.photos[d].photoID]}):""),x.createElement(b.a,{compact:!0,items:[[x.createElement("div",{id:"gf-visit"},"gf-visit"===this.expandedField?x.createElement(O.a,{autoFocus:!0,disabled:!this.canEdit,type:"number",label:Object(o.A)("Visit number"),value:e.visitNumber.toString(),onBlur:()=>{this.expandedField=""},onChange:(e,i)=>{this.props.orthoCase.visits[t].visitNumber=Object(l.r)(i),this.tu()}}):`${Object(o.A)("Visit")} #${e.visitNumber}`)],[x.createElement("div",{id:"gf-date"},"gf-date"===this.expandedField?x.createElement(g.a,{label:Object(o.A)("Visit date"),disabled:!this.canEdit,selectedKey:e.date.toString(),options:this.dates.map(e=>({key:e.date.toString(),text:`${Object(l.j)(e.date,n.bb.getSetting("date_format"))} ${e.treatmentType?`, ${e.treatmentType}`:""}`})),onChange:(e,i)=>{this.props.orthoCase.visits[t].date=Object(l.r)(i.key),this.tu()}}):`${Object(o.A)("Date")}: ${Object(l.j)(e.date,n.bb.getSetting("date_format"))}`)],[x.createElement("div",{id:"gf-appliance"},"gf-appliance"===this.expandedField?x.createElement(O.a,{autoFocus:!0,label:Object(o.A)("Appliance"),value:e.appliance,disabled:!this.canEdit,onBlur:()=>{this.expandedField=""},multiline:!0,onChange:(e,i)=>{this.props.orthoCase.visits[t].appliance=i,this.tu()}}):`${Object(o.A)("Appliance")}: ${e.appliance?e.appliance:Object(o.A)("No appliance info")}`)],[x.createElement("div",{id:"gf-comment"},"gf-comment"===this.expandedField?x.createElement(O.a,{autoFocus:!0,label:Object(o.A)("Comment"),disabled:!this.canEdit,value:c.comment,onBlur:()=>{this.expandedField=""},multiline:!0,onChange:(e,i)=>{this.props.orthoCase.visits[t].photos[d].comment=i,this.tu()}}):`${Object(o.A)("Comment")}: ${c.comment?c.comment:Object(o.A)("no comment on this photo")}`)]],isHeaderVisible:!1,selectionMode:u.b.none,onActiveItemChanged:e=>{this.expandedField=e[0].props.id}}),x.createElement(A.a,{items:[{key:"overlay prev",text:Object(o.A)("Overlay prev"),iconProps:{iconName:"MapLayers"},className:this.overlayWithPrev?"active-button":void 0,onClick:()=>{this.overlayWithPrev=!this.overlayWithPrev},hidden:!this.imagesTable[a.photos[d].photoID]},{key:"overlay next",text:Object(o.A)("Overlay next"),iconProps:{iconName:"MapLayers"},className:this.overlayWithNext?"active-button":void 0,onClick:()=>{this.overlayWithNext=!this.overlayWithNext},hidden:!this.imagesTable[r.photos[d].photoID]}],farItems:[{key:"delete photo",text:Object(o.A)("Delete"),iconProps:{iconName:"trash"},disabled:!this.canEdit,onClick:()=>{this.props.orthoCase.visits[t].photos[d]=new n.p,this.selectedPhotoId="",this.tu()}}]})):""):x.createElement(j.a,{iconName:"sync",className:"rotate"}):x.createElement(s.g,Object.assign({},{crop:!0,allowMultiple:!1,accept:s.r.image,prevSrc:this.imagesTable[a.photos[d].photoID],disabled:!this.canEdit,onFinish:e=>{e[0]&&(this.props.orthoCase.visits[t].photos[d].photoID=e[0],this.tu())},onStartLoading:()=>{this.uploadingPhotoID=c.id},onFinishLoading:()=>{this.uploadingPhotoID=""},targetDir:`${o.g}/${this.props.orthoCase._id}`}),x.createElement(E.a,{content:Object(o.A)("Add photo")},x.createElement(C.a,{iconProps:{iconName:"Photo2Add"},className:"clickable-icon add-photo",disabled:!this.canEdit}))))}),x.createElement("td",null,x.createElement(E.a,{content:Object(o.A)("Delete visit")},x.createElement(C.a,{className:"clickable-icon delete-visit",key:e.id,disabled:!this.canEdit,iconProps:{iconName:"DeleteRows"},onClick:()=>{o.t.newModal({message:Object(o.A)("This visit data will be deleted along with all photos and notes"),onConfirm:()=>{this.props.orthoCase.visits.splice(t,1),this.tu()},showCancelButton:!0,showConfirmButton:!0,id:Math.random()})}})))),x.createElement("tr",{key:e.id+"days"},x.createElement("td",{colSpan:7},i[t+1]?x.createElement("i",{className:"days-num"},Math.round((r.date-e.date)/l.d)," ",Object(o.A)("days")):""))]}))):x.createElement(p.a,{messageBarType:m.a.info},Object(o.A)("No visits recorded yet! add a new visit using the button below")),x.createElement("br",null),x.createElement(N.a,{disabled:!this.canEdit,iconProps:{iconName:"ExploreContent"},text:Object(o.A)("Add visit"),onClick:()=>{const e=this.props.orthoCase.visits.length?this.props.orthoCase.visits.slice().sort((e,t)=>t.visitNumber-e.visitNumber)[0].visitNumber+1:1;this.props.orthoCase.visits.push(new n.x(void 0,e)),this.tu()}})):x.createElement(p.a,{messageBarType:m.a.warning},Object(o.A)("A valid DropBox access token is required for this section")):x.createElement(p.a,{messageBarType:m.a.warning},Object(o.A)("You can not access orthodontic records while offline"))),x.createElement(s.l,{title:Object(o.A)("Notes for the next visit")},x.createElement(r.a,{label:Object(o.A)("Add note"),value:this.props.orthoCase.nextVisitNotes,onChange:e=>{this.props.orthoCase.nextVisitNotes=e,this.tu()},disabled:!this.canEdit})))}tu(){this.props.orthoCase.triggerUpdate++}};a.c([c.k],k.prototype,"selectedPhotoId",void 0),a.c([c.k],k.prototype,"zoomedColumn",void 0),a.c([c.k],k.prototype,"expandedField",void 0),a.c([c.k],k.prototype,"uploadingPhotoID",void 0),a.c([c.k],k.prototype,"imagesTable",void 0),a.c([c.k],k.prototype,"showGrid",void 0),a.c([c.k],k.prototype,"overlayWithPrev",void 0),a.c([c.k],k.prototype,"overlayWithNext",void 0),a.c([c.k],k.prototype,"openCallouts",void 0),a.c([c.d],k.prototype,"canEdit",null),a.c([c.d],k.prototype,"dates",null),a.c([c.d],k.prototype,"allImages",null),k=a.c([h.a],k)}}]);